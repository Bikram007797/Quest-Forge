<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QuestForge - Wall of Fame</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <meta name="mobile-web-app-capable" content="yes">
  <style>
    html, body, #root {
      height: 100%;
      margin: 0;
      padding: 0;
      background: #000;
    }
    
    * {
      touch-action: manipulation;
      -webkit-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    
    button {
      min-height: 44px;
      min-width: 44px;
    }

    body {
      overflow-x: hidden;
    }

    html {
      scroll-behavior: smooth;
    }
    
    * {
      -webkit-overflow-scrolling: touch;
    }

    @keyframes likeAnimation {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }

    @keyframes heartBurst {
      0% {
        transform: scale(0) rotate(0deg);
        opacity: 1;
      }
      50% {
        transform: scale(1.5) rotate(180deg);
        opacity: 0.8;
      }
      100% {
        transform: scale(2) rotate(360deg);
        opacity: 0;
      }
    }

    .like-active {
      animation: likeAnimation 0.3s ease;
    }

    .heart-burst {
      position: absolute;
      font-size: 24px;
      animation: heartBurst 0.6s ease-out forwards;
      pointer-events: none;
    }

    .shimmer {
      background: linear-gradient(90deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0.1) 100%);
      background-size: 200% 100%;
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    .touch-feedback:active {
      transform: scale(0.95);
      opacity: 0.8;
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #1a1a1a;
    }
    ::-webkit-scrollbar-thumb {
      background: #4a4a4a;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #666;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBO-M54POwDhyEkfgyH84fblkOKrfgclck",
      authDomain: "questforge-bd8e8.firebaseapp.com",
      projectId: "questforge-bd8e8",
      storageBucket: "questforge-bd8e8.firebasestorage.app",
      messagingSenderId: "573584114891",
      appId: "1:573584114891:web:a8aa4645c2b859a335474e"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Sound Effects
    const playSound = (type) => {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      if (type === 'like') {
        oscillator.frequency.value = 800;
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.1);
      } else if (type === 'tap') {
        oscillator.frequency.value = 400;
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.05);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.05);
      }
    };

    const WallOfFame = () => {
      const [userData, setUserData] = React.useState(null);
      const [loading, setLoading] = React.useState(true);
      const [likeAnimations, setLikeAnimations] = React.useState({});

      // Load data from Firebase
      React.useEffect(() => {
        const loadData = async () => {
          try {
            const docRef = db.collection('questforge').doc('userData');
            const doc = await docRef.get();
            
            if (doc.exists) {
              const data = doc.data();
              // Initialize like counters if they don't exist
              if (!data.Bikram.currentPostLikes) data.Bikram.currentPostLikes = 0;
              if (!data.Bikram.totalLikesAllTime) data.Bikram.totalLikesAllTime = 0;
              if (!data.Piyali.currentPostLikes) data.Piyali.currentPostLikes = 0;
              if (!data.Piyali.totalLikesAllTime) data.Piyali.totalLikesAllTime = 0;
              setUserData(data);
            }
          } catch (error) {
            console.error('Firebase load error:', error);
          } finally {
            setLoading(false);
          }
        };

        loadData();

        // Real-time listener for updates
        const unsubscribe = db.collection('questforge').doc('userData')
          .onSnapshot((doc) => {
            if (doc.exists) {
              const data = doc.data();
              if (!data.Bikram.currentPostLikes) data.Bikram.currentPostLikes = 0;
              if (!data.Bikram.totalLikesAllTime) data.Bikram.totalLikesAllTime = 0;
              if (!data.Piyali.currentPostLikes) data.Piyali.currentPostLikes = 0;
              if (!data.Piyali.totalLikesAllTime) data.Piyali.totalLikesAllTime = 0;
              setUserData(data);
            }
          });

        return () => unsubscribe();
      }, []);

      const handleLike = async (username, event) => {
        playSound('like');
        
        // Visual feedback
        const button = event.currentTarget;
        button.classList.add('like-active');
        setTimeout(() => button.classList.remove('like-active'), 300);

        // Heart burst effect
        const rect = button.getBoundingClientRect();
        const heartId = Date.now();
        setLikeAnimations(prev => ({
          ...prev,
          [heartId]: {
            x: rect.left + rect.width / 2,
            y: rect.top + rect.height / 2
          }
        }));
        setTimeout(() => {
          setLikeAnimations(prev => {
            const newAnimations = { ...prev };
            delete newAnimations[heartId];
            return newAnimations;
          });
        }, 600);

        // Update Firebase
        try {
          const newData = { ...userData };
          newData[username].currentPostLikes += 1;
          newData[username].totalLikesAllTime += 1;
          
          await db.collection('questforge').doc('userData').set(newData);
        } catch (error) {
          console.error('Like update error:', error);
        }
      };

      if (loading) {
        return (
          <div className="min-h-screen bg-black flex items-center justify-center">
            <div className="text-center">
              <div className="shimmer w-16 h-16 rounded-full mx-auto mb-4"></div>
              <p className="text-white text-lg">Loading Feed...</p>
            </div>
          </div>
        );
      }

      // Get posts and sort by timestamp (latest first)
      const posts = [];
      if (userData?.Bikram?.publishedProfile) {
        posts.push({
          ...userData.Bikram.publishedProfile,
          username: 'Bikram',
          currentLikes: userData.Bikram.currentPostLikes || 0,
          totalLikes: userData.Bikram.totalLikesAllTime || 0,
          timestamp: userData.Bikram.publishedProfile.timestamp
        });
      }
      if (userData?.Piyali?.publishedProfile) {
        posts.push({
          ...userData.Piyali.publishedProfile,
          username: 'Piyali',
          currentLikes: userData.Piyali.currentPostLikes || 0,
          totalLikes: userData.Piyali.totalLikesAllTime || 0,
          timestamp: userData.Piyali.publishedProfile.timestamp
        });
      }

      // Sort by timestamp (latest first)
      posts.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

      return (
        <div className="min-h-screen bg-black">
          {/* Header */}
          <div className="sticky top-0 z-50 bg-gradient-to-b from-black to-gray-900 border-b border-gray-800 backdrop-blur-lg bg-opacity-90">
            <div className="max-w-2xl mx-auto px-4 py-3">
              <div className="flex items-center justify-between">
                <h1 className="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500">
                  ‚öîÔ∏è Wall of Fame
                </h1>
                <div className="flex items-center gap-2">
                  <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                  <span className="text-gray-400 text-sm">Live</span>
                </div>
              </div>
            </div>
          </div>

          {/* Posts Feed */}
          <div className="max-w-2xl mx-auto pb-20">
            {posts.length === 0 ? (
              <div className="flex flex-col items-center justify-center py-20 px-4">
                <div className="text-6xl mb-4">üèÜ</div>
                <p className="text-gray-400 text-lg text-center">No posts yet</p>
                <p className="text-gray-600 text-sm text-center mt-2">
                  Publish your profile to appear here!
                </p>
              </div>
            ) : (
              posts.map((post, index) => (
                <div key={`${post.username}-${post.timestamp}`} className="mb-6">
                  {/* Post Container */}
                  <div className="bg-gradient-to-br from-gray-900 to-black border-t border-b border-gray-800">
                    {/* Post Header */}
                    <div className="px-4 py-3 flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <div className="w-10 h-10 rounded-full border-2 border-purple-500 overflow-hidden">
                          <img src={post.avatarUrl} alt={post.avatarName} className="w-full h-full object-cover" />
                        </div>
                        <div>
                          <p className="text-white font-semibold text-sm">{post.avatarName}</p>
                          <p className="text-gray-400 text-xs">@{post.username}</p>
                        </div>
                      </div>
                      <div className="flex flex-col items-end">
                        <div className="bg-gradient-to-r from-purple-600 to-pink-600 px-3 py-1 rounded-full">
                          <p className="text-white text-xs font-bold">Total Likes - {post.totalLikes}</p>
                        </div>
                        <p className="text-gray-600 text-xs mt-1">{post.timestamp}</p>
                      </div>
                    </div>

                    {/* Post Content - Profile Card */}
                    <div className="px-4 pb-3">
                      <div className="bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 rounded-2xl p-6 border border-purple-500 shadow-2xl">
                        {/* Avatar Section */}
                        <div className="flex flex-col items-center mb-4">
                          <div className="w-24 h-24 rounded-full border-4 border-yellow-400 overflow-hidden mb-3 shadow-lg shadow-purple-500">
                            <img src={post.avatarUrl} alt={post.avatarName} className="w-full h-full object-cover" />
                          </div>
                          <h2 className="text-2xl font-bold text-white text-center">{post.avatarName}</h2>
                          <p className="text-purple-300 text-sm">Level {post.level} ‚Ä¢ {post.levelName}</p>
                        </div>

                        {/* Stats Grid */}
                        <div className="grid grid-cols-2 gap-3 mb-4">
                          <div className="bg-black bg-opacity-40 rounded-lg p-3 border border-purple-600">
                            <p className="text-gray-400 text-xs mb-1">Total XP</p>
                            <p className="text-yellow-400 text-xl font-bold">{post.totalXP}</p>
                          </div>
                          <div className="bg-black bg-opacity-40 rounded-lg p-3 border border-purple-600">
                            <p className="text-gray-400 text-xs mb-1">Power</p>
                            <p className="text-green-400 text-xl font-bold">{post.power.toFixed(1)}%</p>
                          </div>
                          <div className="bg-black bg-opacity-40 rounded-lg p-3 border border-purple-600">
                            <p className="text-gray-400 text-xs mb-1">Skills</p>
                            <p className="text-blue-400 text-xl font-bold">{post.totalPurchased}</p>
                          </div>
                          <div className="bg-black bg-opacity-40 rounded-lg p-3 border border-purple-600">
                            <p className="text-gray-400 text-xs mb-1">Equipped</p>
                            <p className="text-pink-400 text-xl font-bold">{post.equippedCount}</p>
                          </div>
                        </div>

                        {/* Rank Section */}
                        <div className="bg-black bg-opacity-40 rounded-lg p-4 border border-yellow-500">
                          <div className="flex items-center justify-between">
                            <div>
                              <p className="text-gray-400 text-xs mb-1">Military Rank</p>
                              <p className="text-yellow-300 text-lg font-bold">{post.rank}</p>
                            </div>
                            <div className="text-right">
                              <p className="text-yellow-400 text-2xl">{'‚òÖ'.repeat(post.stars)}</p>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    {/* Post Actions */}
                    <div className="px-4 py-2 border-t border-gray-800">
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-1">
                          <button
                            onClick={(e) => handleLike(post.username, e)}
                            className="touch-feedback flex items-center gap-2 px-4 py-2 rounded-full hover:bg-gray-800 transition-all duration-200"
                          >
                            <span className="text-2xl">‚ù§Ô∏è</span>
                            <span className="text-white font-semibold">{post.currentLikes}</span>
                          </button>
                          <button
                            onClick={() => playSound('tap')}
                            className="touch-feedback flex items-center gap-2 px-4 py-2 rounded-full hover:bg-gray-800 transition-all duration-200"
                          >
                            <span className="text-2xl">üí¨</span>
                            <span className="text-gray-400 font-semibold">0</span>
                          </button>
                        </div>
                        <div className="flex items-center gap-1">
                          <button
                            onClick={() => playSound('tap')}
                            className="touch-feedback flex items-center gap-2 px-4 py-2 rounded-full hover:bg-gray-800 transition-all duration-200"
                          >
                            <span className="text-2xl">üîó</span>
                          </button>
                          <button
                            onClick={() => playSound('tap')}
                            className="touch-feedback flex items-center gap-2 px-4 py-2 rounded-full hover:bg-gray-800 transition-all duration-200"
                          >
                            <span className="text-2xl">üì§</span>
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              ))
            )}
          </div>

          {/* Heart Burst Animations */}
          {Object.entries(likeAnimations).map(([id, pos]) => (
            <div
              key={id}
              className="heart-burst"
              style={{ left: pos.x, top: pos.y }}
            >
              ‚ù§Ô∏è
            </div>
          ))}

          {/* Bottom Navigation (Visual Only) */}
          <div className="fixed bottom-0 left-0 right-0 bg-black border-t border-gray-800 py-2">
            <div className="max-w-2xl mx-auto px-4">
              <div className="flex items-center justify-around">
                {['üè†', 'üîç', '‚ûï', 'üîî', 'üë§'].map((icon, i) => (
                  <button
                    key={i}
                    onClick={() => playSound('tap')}
                    className="touch-feedback p-3 rounded-full hover:bg-gray-800 transition-all duration-200"
                  >
                    <span className="text-2xl">{icon}</span>
                  </button>
                ))}
              </div>
            </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<WallOfFame />);
  </script>
</body>
</html>
